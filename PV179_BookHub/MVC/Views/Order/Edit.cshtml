@using MVC.Models.Order
@model MVC.Models.Order.OrderEditViewModel
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<div class="container">
    @using (Html.BeginForm("Edit", "Order", FormMethod.Post, new { id = "form" }))
    {
        <div class="row">
            <div class="col-md-8">
                <div class="mb-4">
                    <h2>Specify Order</h2>
                </div>

                <div class="mb-4">
                    <h5>Select bookstore</h5>
                    @Html.DropDownListFor(
                model => model.SelectedBookStore,
                new SelectList(Model.AvailableBookStores, "Id", "Name"),
                new { @class = "form-control" }
                )
                </div>

                <div class="mb-4">
                    <h4>Add books to the order</h4>
                    <div style="max-height: 200px; overflow-y: auto;">
                        @Html.ListBoxFor(
                    model => model.AddedOrderItems,
                    new MultiSelectList(Model.AvailableBooks, "Id", "Title"),
                    new { @class = "form-control" }
                    )
                    </div>
                    <button type="button" id="addSelectedBooks" class="btn btn-primary mt-2">Add Selected Books</button>
                    <div id="orderItemsContainer" style="margin-top: 10px;">
                       
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="mb-4">
                    <h4>Order content:</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Book Title</th>
                                <th>Quantity</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.OrderItems.Count; i++)
                            {
                                <tr>
                                    <td>@Model.OrderItems[i].Id</td>
                                    <td>@Model.OrderItems[i].Book.Title</td>
                                    <td><input type="number" name="OrderItems[@i].Quantity" value="@Model.OrderItems[i].Quantity" min="1" /></td>
                                    <td><input type="checkbox" name="RemovedOrderItems" value="@Model.OrderItems[i].Id" /></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <input type="hidden" id="AvailableBookStores" name="AvailableBookStores" />
                <button id="submit" type="submit" class="btn btn-primary">Submit</button>
            </div>
        </div>
    }
</div>

<script>
    //zatial nefunguje dynamicke pridavanie quantity
    $(document).ready(function () {
        $('#addSelectedBooks').click(function () {
            var selectedBooksList = $('#AddedOrderItems');
            var orderItemsContainer = $('#orderItemsContainer');

            orderItemsContainer.html('');

            selectedBooksList.find(':selected').each(function (index, option) {
                var bookId = $(option).val();
                var bookTitle = $(option).text();

                var quantity = parseInt($('#quantity_' + bookId).val()) || 1;

                orderItemsContainer.append('<div class="row">' +
                    '<input type="hidden" name="AddedItems[' + bookId + ']" value="1" />' +
                    '<div class="col-md-6">' + bookTitle + '</div>' +
                    '<div class="col-md-3"><input type="number" id="quantity_' + bookId + '" name="AddedItems[' + bookId + ']" value= "1" min="1" /></div>' +
                    '</div>');
            });
        });
    });
</script>



