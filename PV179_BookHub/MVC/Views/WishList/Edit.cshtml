@using MVC.Models.WishList;
@model WishListUpdateViewModel;

@using (Html.BeginForm("Edit", "WishList", FormMethod.Post))
{
    <h1>WishList</h1>

    <div class="row" style="width: 100%">
        <label asp-for="Description"></label>
        <input asp-for="Description" value="@Model.Description" />
        <span asp-validation-for="Description"></span>
    </div>

    <div class="row" style="width: 100%">
        <h2>Wish list content:</h2>
        <div>
            @if (Model.WishListItems.Count() != 0)
            {
                <table>
                    <thead>
                        <tr>
                            <th>Book Title</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.WishListItems)
                        {
                            <tr>
                                <td>
                                    <input asp-for="@item.Book.Title" readonly />
                                </td>
                                <td>
                                    <input asp-for="@item.Id" />
                                    <input asp-for="@item.WishListId" />
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>No items in the wishlist.</p>
            }
        </div>

        <div id="newWishListItems">
            <b>Add Item to wishlist</b>

            @Html.DropDownList("selectedBookId", new SelectList(Model.AvailableBooks, "Id", "Title"), "Select a Book", new { @class = "form-control" })

            <button type="button" id="addNewItem">Add Item</button>
        </div>
    </div>

    <button type="submit">Update my WishList</button>
}

@section scripts {
    <script>
        $(document).ready(function () {
            $('.delete-item').click(function () {
                var itemId = $(this).data('item-id');
                console.log('Deleting item with ID: ' + itemId);
                $(this).closest('tr').remove();
            });

            $('#addNewItem').click(function () {
                var selectedBookId = $('#selectedBookId').val();
                var selectedBookTitle = $('#selectedBookId option:selected').text();

                if (selectedBookId && selectedBookTitle) {
                    console.log("Adding item");
                    var newItemHtml = `
                                        <li>
                                            ${selectedBookTitle}
                                            <input type="hidden" name="newWishListItems" value="${selectedBookId}" />
                                            <button type="button" class="delete-new-item">Delete</button>
                                        </li>
                                    `;
                    $('#newWishListItems ul').append(newItemHtml);

                    $('#selectedBookId').val('');
                }
            });
        });
    </script>
}
